# 总结

代码只是做了最基本的微服务下单流程模拟，没有涉及 RocketMQ、API网关等。后续有机会再补充。

### 性能的进一步提升
此时性能瓶颈大概率来自基础组件，例如 Redis 单实例 set指令benmark 性能在 15w/s，考虑到下单会涉及多个redis指令和lua，要以10w/s的库存增减操作来容错考量。

此时，要再解决性能瓶颈，就必须引入 Redis Cluster 或其它更快的内存计算组件，例如VoltDB，逻辑层可将库存拆分成多个小库存，再或者从业务逻辑上减少碰撞（下单只有一件商品）。库存数据库落盘也需要走`合并变更一次改动`的套路，通过减少写次数而提升吞吐。

订单也需要拆2PC框架，例如库存锁定完毕，就生成预订单，再异步并行处理其它订单相关逻辑，最终再将预订单转移成正式订单，全部走流水模式去处理，像是 Seata 的 Saga 模式。

每一块业务逻辑都需要改写，都会重度使用队列去重构 RPC 功能。

线程池数量、Linux 网络参数、Http2/Http3 等配置，都需要调教。

更底层技术：JVM、Linux 内核、服务器硬件、路由器等都需要做适应性改造。

... 

细节是魔鬼。


